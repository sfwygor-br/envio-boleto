unit UPreferencias;

interface

uses
  Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
  Dialogs, StdCtrls, ComCtrls, ExtCtrls, Buttons, IniFiles, UCodeSql, UInicializa;

type
  TFPreferencias = class(TForm)
    GroupBox1: TGroupBox;
    Label1: TLabel;
    ColorBox1: TColorBox;
    ColorBox2: TColorBox;
    Label2: TLabel;
    Label3: TLabel;
    GroupBox2: TGroupBox;
    Label4: TLabel;
    ColorBox4: TColorBox;
    Label5: TLabel;
    ColorBox5: TColorBox;
    Label6: TLabel;
    Edit1: TEdit;
    Label7: TLabel;
    ComboBox1: TComboBox;
    ComboBox2: TComboBox;
    ColorBox3: TColorBox;
    Label8: TLabel;
    Edit2: TEdit;
    Label9: TLabel;
    BitBtn1: TBitBtn;
    procedure FormCreate(Sender: TObject);
    procedure BitBtn1Click(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  FPreferencias: TFPreferencias;

implementation

{$R *.dfm}

procedure TFPreferencias.FormCreate(Sender: TObject);
var     ArquivoIni: TIniFile;
begin
        ArquivoIni := TIniFile.Create(ExtractFilePath(Application.ExeName) + 'CS.ini');
        //configurações do ambiente
        ColorBox1.Selected  := StrToInt(ArquivoIni.ReadString('AMBIENTE', 'BgColor', IntToStr(ColorBox1.Selected)));
        ColorBox2.Selected  := StrToInt(ArquivoIni.ReadString('AMBIENTE', 'FontColor', IntToStr(ColorBox2.Selected)));
        ComboBox1.ItemIndex := StrToInt(ArquivoIni.ReadString('AMBIENTE', 'FontStyleItemIndex', IntToStr(ComboBox1.ItemIndex)));

        //configurações do editor
        ColorBox4.Selected  := StrToInt(ArquivoIni.ReadString('EDITOR', 'BgColor', IntToStr(ColorBox4.Selected)));
        ColorBox5.Selected  := StrToInt(ArquivoIni.ReadString('EDITOR', 'FontColor', IntToStr(ColorBox5.Selected)));
        ColorBox3.Selected  := StrToInt(ArquivoIni.ReadString('EDITOR', 'FontColorKeyWords', IntToStr(ColorBox3.Selected)));
        ComboBox2.ItemIndex := StrToInt(ArquivoIni.ReadString('EDITOR', 'FontStyleItemIndex', IntToStr(ComboBox2.ItemIndex)));
        Edit2.Text  := ArquivoIni.ReadString('EDITOR', 'FontSize', '14');
        Edit1.Text  := ArquivoIni.ReadString('EDITOR', 'Tab', '2');
        ArquivoIni.Free;
end;

procedure TFPreferencias.BitBtn1Click(Sender: TObject);
var     ArquivoIni: TIniFile;
        test:Integer;
begin
        try
           test := StrToInt(Edit2.Text);
        except on E: Exception do
        begin
           MessageDlg('Número inválido!', mtError, [mbOK], 0);
           Edit2.Text := '';
           Edit2.SetFocus;
           Abort;
        end;
        end;

        try
           test := StrToInt(Edit1.Text);
        except on E: Exception do
        begin
           MessageDlg('Número inválido!', mtError, [mbOK], 0);
           Edit1.Text := '';
           Edit1.SetFocus;
           Abort;
        end;
        end;
        
        ArquivoIni := TIniFile.Create(ExtractFilePath(Application.ExeName) + 'CS.ini');
        //configurações do ambiente
        ArquivoIni.WriteString('AMBIENTE', 'BgColor', IntToStr(ColorBox1.Selected));
        ArquivoIni.WriteString('AMBIENTE', 'FontColor', IntToStr(ColorBox2.Selected));
        ArquivoIni.WriteString('AMBIENTE', 'FontStyleItemIndex', IntToStr(ComboBox1.ItemIndex));
        ArquivoIni.WriteString('AMBIENTE', 'FontStyleName', ComboBox1.Items.Strings[ComboBox1.ItemIndex]);

        //configurações do editor
        ArquivoIni.WriteString('EDITOR', 'BgColor', IntToStr(ColorBox4.Selected));
        ArquivoIni.WriteString('EDITOR', 'FontColor', IntToStr(ColorBox5.Selected));
        ArquivoIni.WriteString('EDITOR', 'FontColorKeyWords', IntToStr(ColorBox3.Selected));
        ArquivoIni.WriteString('EDITOR', 'FontStyleItemIndex', IntToStr(ComboBox2.ItemIndex));
        ArquivoIni.WriteString('EDITOR', 'FontStyleName', ComboBox2.Items.Strings[ComboBox2.ItemIndex]);
        ArquivoIni.WriteString('EDITOR', 'FontSize', Edit2.Text);
        ArquivoIni.WriteString('EDITOR', 'Tab', Edit1.Text);
        ArquivoIni.Free;

        FCodeSql.Reload := True;
        Self.Close;
end;

end.
